/*
 *  game-of-life.js - v0.2.3
 *  HTML5 canvas game of life.
 *  https://github.com/eschmar/game-of-life
 *
 *  @author:   Marcel Eschmann, @eschmar
 *  @license:  MIT License
 */
!function(t,o){"use strict";var e={cellSize:8,colors:["#490D7F","#B666FF","#921AFF","#5B337F","#7515CC"],colorEmpty:"#fafafa",transparent:!0,speed:100,onClick:!1};function i(t,i){this.element=o.querySelector(t),"CANVAS"===this.element.nodeName&&(this.settings=this.extend({},e,i),this.init())}i.prototype.init=function(){this.ctx=this.element.getContext("2d"),this.xLength=Math.floor(this.element.width/this.settings.cellSize),this.yLength=Math.floor(this.element.height/this.settings.cellSize),this.population=[];for(var t=0;t<this.xLength;t++)this.population[t]=[];this.settings.onClick&&this.initOnClick()},i.prototype.initOnClick=function(){function t(t){var i,e,s=n.element.getBoundingClientRect();i=t.pageX-s.left+o.body.scrollLeft,e=t.pageY-s.top+o.body.scrollTop,n.settings.onClick(n,Math.floor(i/n.settings.cellSize),Math.floor(e/n.settings.cellSize)),t.stopPropagation()}var n=this;this.element.addEventListener("click",t),this.element.addEventListener("touchstart",t)},i.prototype.populate=function(t,i){var e=Math.floor(Math.random()*this.settings.colors.length);this.ctx.fillStyle=this.settings.colors[e],this.ctx.fillRect(t*this.settings.cellSize+1,i*this.settings.cellSize+1,this.settings.cellSize-1,this.settings.cellSize-1)},i.prototype.kill=function(t,i){this.settings.transparent?this.ctx.clearRect(t*this.settings.cellSize+1,i*this.settings.cellSize+1,this.settings.cellSize-1,this.settings.cellSize-1):(this.ctx.fillStyle=this.settings.colorEmpty,this.ctx.fillRect(t*this.settings.cellSize+1,i*this.settings.cellSize+1,this.settings.cellSize-1,this.settings.cellSize-1))},i.prototype.live=function(t,i){var e=this.neighbours(t,i);this.population[t][i]&&(e<2||3<e)?this.future[t][i]=!1:3===e&&(this.future[t][i]=!0)},i.prototype.neighbours=function(t,i){for(var e,s,n=0,o=-1;o<2;o++)for(var h=-1;h<2;h++)e=(t+o+this.xLength)%this.xLength,s=(i+h+this.yLength)%this.yLength,this.population[e][s]&&n++;return this.population[t][i]&&n--,n},i.prototype.randomize=function(){for(var t=0;t<this.xLength;t++)for(var i=0;i<this.yLength;i++)Math.floor(10*Math.random()%2)&&(this.populate(t,i,0),this.population[t][i]=!0)},i.prototype.killAll=function(){var t=this.alive;this.alive&&this.toggle();for(var i=0;i<this.xLength;i++)for(var e=0;e<this.yLength;e++)this.population[i][e]=!1,this.kill(i,e);this.future=this.extend(!0,[],this.population),t&&this.toggle()},i.prototype.addLifeForm=function(t,i,e){var s,n,o;for(o=0;o<e.length;o++)s=(t+e[o][0]+this.xLength)%this.xLength,n=(i+e[o][1]+this.yLength)%this.yLength,this.populate(s,n),this.population[s][n]=!0},i.prototype.advance=function(){this.future=this.deepExtend([],this.population);for(var t=0;t<this.xLength;t++)for(var i=0;i<this.yLength;i++)this.live(t,i);for(t=0;t<this.xLength;t++)for(i=0;i<this.yLength;i++)this.population[t][i]!==this.future[t][i]&&(this.future[t][i]?this.populate(t,i):this.kill(t,i));this.population=this.future},i.prototype.toggle=function(){if(this.alive)clearInterval(this.timer),this.alive=!1;else{var t=this;this.timer=setInterval(function(){t.advance()},this.settings.speed),this.alive=!0}},i.prototype.extend=function(t){t=t||{};for(var i=1;i<arguments.length;i++)if(arguments[i])for(var e in arguments[i])arguments[i].hasOwnProperty(e)&&(t[e]=arguments[i][e]);return t},i.prototype.deepExtend=function(t){t=t||{};for(var i=1;i<arguments.length;i++){var e=arguments[i];if(e)for(var s in e)e.hasOwnProperty(s)&&("object"==typeof e[s]?t[s]=this.deepExtend(t[s],e[s]):t[s]=e[s])}return t},t.GameOfLife=i}(window,document);